<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Advanced CV Builder - Final</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  :root {
    --main-color: #2f558d; /* default Blue */
    --header-gradient: linear-gradient(135deg,#2f558d,#3a7bd5);
    --footer-color: #2f558d;
  }

  body {
    margin: 0;
    font-family: Arial, Helvetica, sans-serif;
    display: flex;
    height: 100vh;
    background: #f0f2f5;
    color: #111;
  }

  /* SIDEBAR */
  .sidebar {
    width: 34%;
    background: #fff;
    padding: 18px;
    overflow-y: auto;
    border-right: 1px solid #e0e0e0;
  }
  .sidebar h2 { margin: 0 0 8px 0; color: var(--main-color); }
  .section { margin-bottom: 18px; }
  label { display: block; font-weight: 600; margin-top: 8px; }
  input[type="text"], input[type="email"], input[type="date"], textarea {
    width: 100%; padding: 8px; margin-top:6px; border: 1px solid #cfcfcf; border-radius:6px;
    box-sizing: border-box;
  }
  textarea { resize: vertical; }

  .controls { display:flex; gap:8px; justify-content:space-between; margin-bottom:8px; }
  .controls button { background:var(--main-color); color:#fff; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; }
  .controls button:hover { opacity:.95; }

  /* top color picker */
  .color-row { display:flex; align-items:center; gap:10px; margin-bottom:10px; }
  .color-row label{ margin:0; font-weight:600; color:#333; }

  /* Two-column personal grid */
  .personal-grid{ display:grid; grid-template-columns:1fr 1fr; gap:10px 16px; align-items:start; }

  /* PREVIEW */
  .preview { width: 66%; display:flex; justify-content:center; align-items:flex-start; padding:20px; overflow:auto; }
  .cv-page {
    width:100%; max-width:8.27in; /* A4 width exact */
    background:#fff;
    box-shadow:0 6px 18px rgba(0,0,0,.08);
    position:relative;
    padding-bottom:60px;
    box-sizing:border-box;
    color:#111;
  }

  .header-shape{
    width:100%; height:60px; background:var(--header-gradient);
    border-bottom-left-radius:50% 40px; border-bottom-right-radius:50% 40px;
    display:flex; align-items:center; justify-content:center; color:#fff;
    font-weight:700; font-size:18px;
  }

  /* profile area inline (reduced gap) */
  .profile-inline { display:flex; align-items:center; gap:14px; padding:10px 20px 0 20px; margin-top:-36px; }
  .profile-preview-small{ width:100px; height:100px; border-radius:50%; overflow:hidden; border:4px solid #fff; background:#fff; }
  .profile-preview-small img{ width:100%; height:100%; object-fit:cover; display:block; }

  .content { padding:8px 22px 40px 22px; }
  .content h3{ margin-top:8px; margin-bottom:8px; padding-bottom:6px; border-bottom:2px solid var(--main-color); color:var(--main-color); font-size:15px; }

  /* Personal info grid in preview */
  .preview-personal { display:grid; grid-template-columns:1fr 1fr; gap:10px 12px; }

  /* Education table */
  table { width:100%; border-collapse:collapse; margin-top:6px; }
  th, td { border:1px solid var(--main-color); padding:6px; font-size:13px; text-align:left; }
  th { background:var(--main-color); color:#fff; font-weight:600; }

  /* lists */
  .plain-list { list-style:none; padding-left:0; margin:6px 0 0 0; }
  .plain-list li{ margin-bottom:6px; display:flex; align-items:flex-start; gap:8px; }
  .plain-list li i { color:var(--main-color); width:18px; text-align:center; margin-top:2px; }

  .footer-shape{
    width:100%; height:40px; position:absolute; bottom:0; background:var(--footer-color); border-top-left-radius:50% 40px; border-top-right-radius:50% 40px;
  }

  /* small responsive */
  @media (max-width:900px){
    .sidebar{ width:100%; height:auto; position:relative; }
    .preview{ display:block; width:100%; padding:12px; }
    body{ flex-direction:column; height:100%; }
  }
</style>
</head>
<body>

  <!-- SIDEBAR -->
  <div class="sidebar" id="formSidebar">
    <!-- Template Color on top -->
    <div class="section color-row">
      <label for="colorPicker">Template Color</label>
      <input id="colorPicker" type="color" value="#2f558d" onchange="updateColor()" title="Pick template color">
    </div>

    <div class="controls">
      <button onclick="downloadPDF()">Download PDF</button>
      <button onclick="resetDemo()">Reset (demo)</button>
    </div>

    <!-- Personal Info -->
    <div class="section">
      <h2>Personal Info</h2>
      <div class="personal-grid">
        <div>
          <label>Full Name</label>
          <input id="fullName" type="text" oninput="updateCV()">

          <label>Date of Birth</label>
          <input id="dob" type="date" oninput="updateCV()">

          <label>Religion</label>
          <input id="religion" type="text" oninput="updateCV()">

          <label>Nationality</label>
          <input id="nationality" type="text" oninput="updateCV()">

          <label>Profile Photo</label>
          <input id="imgUpload" type="file" accept="image/*" onchange="previewImage(event)">
        </div>

        <div>
          <label>Father's Name</label>
          <input id="fatherName" type="text" oninput="updateCV()">

          <label>CNIC</label>
          <input id="cnic" type="text" oninput="updateCV()">

          <label>Marital Status</label>
          <input id="marital" type="text" oninput="updateCV()">

          <label>Email</label>
          <input id="email" type="email" oninput="updateCV()">

          <label>Phone</label>
          <input id="phone" type="text" oninput="updateCV()">
        </div>
      </div>
    </div>

    <!-- Education -->
    <div class="section">
      <h2>Education</h2>
      <table>
        <thead>
          <tr><th>Qualification</th><th>Passing Year</th><th>Marks</th><th>Board</th></tr>
        </thead>
        <tbody id="eduTableBody">
          <tr>
            <td contenteditable="true" oninput="updateCV()">B.Sc</td>
            <td contenteditable="true" oninput="updateCV()">2024</td>
            <td contenteditable="true" oninput="updateCV()">85%</td>
            <td contenteditable="true" oninput="updateCV()">PU</td>
          </tr>
        </tbody>
      </table>
      <div style="margin-top:8px;">
        <button onclick="addEducationRow()" style="background:#2f558d;color:#fff;border:none;padding:8px 10px;border-radius:6px;cursor:pointer;">Add Row</button>
      </div>
    </div>

    <!-- Skills / Languages / Experience / References -->
    <div class="section">
      <h2>Skills</h2>
      <textarea id="skillsInput" rows="3" placeholder="Comma or newline separated" oninput="updateCV()"></textarea>
    </div>

    <div class="section">
      <h2>Languages</h2>
      <textarea id="langInput" rows="2" placeholder="Comma or newline separated" oninput="updateCV()"></textarea>
    </div>

    <div class="section">
      <h2>Experience</h2>
      <textarea id="expInput" rows="3" placeholder="Comma or newline separated" oninput="updateCV()"></textarea>
    </div>

    <div class="section">
      <h2>References</h2>
      <textarea id="refInput" rows="2" placeholder="Comma or newline separated" oninput="updateCV()"></textarea>
    </div>
  </div>

  <!-- PREVIEW -->
  <div class="preview">
    <div class="cv-page" id="cvPage">
      <div class="header-shape" id="headerShape">Curriculum Vitae</div>

      <div class="profile-inline">
        <div class="profile-preview-small" id="profileSmall">
          <img id="photoPreview" src="" alt="">
        </div>
        <div style="flex:1;">
          <!-- small title next to photo (keeps same compact look) -->
          <div style="font-weight:700; color:var(--main-color); font-size:18px;">Curriculum Vitae</div>
        </div>
      </div>

      <div class="content">
        <h3>Personal Info</h3>
        <div class="preview-personal">
          <div>
            <p><strong>Name:</strong> <span id="namePrev"></span></p>
            <p><strong>Date of Birth:</strong> <span id="dobPrev"></span></p>
            <p><strong>Religion:</strong> <span id="religionPrev"></span></p>
            <p><strong>Nationality:</strong> <span id="nationalityPrev"></span></p>
          </div>
          <div>
            <p><strong>Father's Name:</strong> <span id="fatherPrev"></span></p>
            <p><strong>CNIC:</strong> <span id="cnicPrev"></span></p>
            <p><strong>Marital Status:</strong> <span id="maritalPrev"></span></p>
            <p><strong>Email:</strong> <span id="emailPrev"></span></p>
            <p><strong>Phone:</strong> <span id="phonePrev"></span></p>
          </div>
        </div>

        <h3>Education</h3>
        <table id="eduPrevTable">
          <thead><tr><th>Qualification</th><th>Passing Year</th><th>Marks</th><th>Board</th></tr></thead>
          <tbody></tbody>
        </table>

        <h3>Skills</h3>
        <ul class="plain-list" id="skillsPrev"></ul>

        <h3>Languages</h3>
        <ul class="plain-list" id="langPrev"></ul>

        <h3>Experience</h3>
        <ul class="plain-list" id="expPrev"></ul>

        <h3>References</h3>
        <ul class="plain-list" id="refPrev"></ul>
      </div>

      <div class="footer-shape"></div>
    </div>
  </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
/* ---------- Helpers & Initialization ---------- */

// ensure default color is applied on load
(function init(){
  updateColor();         // apply initial color
  updateCV();            // ensure preview empty state sync
  // attach input listeners to existing editable edu cells (for safety)
  document.querySelectorAll('#eduTableBody td[contenteditable="true"]').forEach(td=>{
    td.addEventListener('input', updateCV);
  });
})();

/* Update color (applies to header, table headers, icons) */
function updateColor(){
  const color = document.getElementById('colorPicker').value || '#2f558d';
  // header gradient: simple gradient from color to a slightly lighter one
  const lighter = shadeColor(color, 18);
  document.documentElement.style.setProperty('--main-color', color);
  document.documentElement.style.setProperty('--header-gradient', `linear-gradient(135deg, ${color}, ${lighter})`);
  document.documentElement.style.setProperty('--footer-color', color);

  // also apply to dynamic elements that rely on inline style (th and icons)
  document.querySelectorAll('th').forEach(th=> th.style.background = color);
  document.querySelectorAll('.plain-list li i').forEach(ic => ic.style.color = color);
}

/* small color shade helper (makes a lighter variant) */
function shadeColor(hex, percent) {
  // hex to rgb, then lighten
  const c = hex.replace('#','');
  const num = parseInt(c,16);
  let r = (num >> 16) + percent;
  let g = ((num >> 8) & 0x00FF) + percent;
  let b = (num & 0x0000FF) + percent;
  r = Math.min(255, Math.max(0, r));
  g = Math.min(255, Math.max(0, g));
  b = Math.min(255, Math.max(0, b));
  return '#' + ( (1<<24) + (r<<16) + (g<<8) + b ).toString(16).slice(1);
}

/* ---------- Preview Update Function ---------- */
function updateCV(){
  // Personal info (reading values from the two-column inputs)
  document.getElementById('namePrev').textContent = document.getElementById('fullName').value || '';
  document.getElementById('fatherPrev').textContent = document.getElementById('fatherName').value || '';
  // dob: show in readable format if present
  const dobVal = document.getElementById('dob').value || '';
  document.getElementById('dobPrev').textContent = dobVal ? dobVal : '';
  document.getElementById('cnicPrev').textContent = document.getElementById('cnic').value || '';
  document.getElementById('religionPrev').textContent = document.getElementById('religion').value || '';
  document.getElementById('maritalPrev').textContent = document.getElementById('marital').value || '';
  document.getElementById('nationalityPrev').textContent = document.getElementById('nationality').value || '';
  document.getElementById('emailPrev').textContent = document.getElementById('email').value || '';
  document.getElementById('phonePrev').textContent = document.getElementById('phone').value || '';

  // Education: copy rows from editable table to preview table
  const eduPrevBody = document.querySelector('#eduPrevTable tbody');
  const eduRows = document.querySelectorAll('#eduTableBody tr');
  eduPrevBody.innerHTML = '';
  eduRows.forEach(row=>{
    const tr = document.createElement('tr');
    row.querySelectorAll('td').forEach(td=>{
      const tdCopy = document.createElement('td');
      tdCopy.textContent = td.textContent.trim();
      tr.appendChild(tdCopy);
    });
    eduPrevBody.appendChild(tr);
  });

  // Utility to parse comma/newline separated items and render bullets with icons
  const updateListWithIcons = (inputId, prevId, iconClass) => {
    const text = document.getElementById(inputId).value || '';
    // split by comma or newline
    const items = text.split(/[\n,]+/).map(s=>s.trim()).filter(Boolean);
    const container = document.getElementById(prevId);
    container.innerHTML = '';
    items.forEach(it=>{
      const li = document.createElement('li');
      li.innerHTML = `<i class="${iconClass}"></i><span>${it}</span>`;
      container.appendChild(li);
    });
  };

  updateListWithIcons('skillsInput','skillsPrev','fa fa-check');
  updateListWithIcons('langInput','langPrev','fa fa-language');
  updateListWithIcons('expInput','expPrev','fa fa-briefcase');
  updateListWithIcons('refInput','refPrev','fa fa-user');

  // update icons color to match current colorPicker
  const color = document.getElementById('colorPicker').value || '#2f558d';
  document.querySelectorAll('.plain-list li i').forEach(ic => ic.style.color = color);
  // table headers color
  document.querySelectorAll('#eduPrevTable th').forEach(th => th.style.background = color);
}

/* ---------- Image Preview (single function used by file input) ---------- */
function previewImage(event){
  const file = event.target.files && event.target.files[0];
  if(!file) return;
  const url = URL.createObjectURL(file);
  // set both small sidebar preview and main cv preview
  const sidebarPreview = document.getElementById('profileSmall').querySelector('img');
  const mainPreview = document.getElementById('photoPreview');
  sidebarPreview.src = url;
  mainPreview.src = url;
}

/* ---------- Education row add ---------- */
function addEducationRow(){
  const tbody = document.getElementById('eduTableBody');
  const row = tbody.insertRow();
  for(let i=0;i<4;i++){
    const cell = row.insertCell();
    cell.contentEditable = "true";
    cell.innerText = '';
    cell.addEventListener('input', updateCV);
  }
  updateCV();
}

/* ---------- Reset demo (clears fields) ---------- */
function resetDemo(){
  // clear inputs
  ['fullName','fatherName','dob','cnic','religion','marital','nationality','email','phone','skillsInput','langInput','expInput','refInput'].forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.value = '';
  });
  // reset edu table to single empty row
  const tbody = document.getElementById('eduTableBody');
  tbody.innerHTML = '<tr><td contenteditable="true" oninput="updateCV()"></td><td contenteditable="true" oninput="updateCV()"></td><td contenteditable="true" oninput="updateCV()"></td><td contenteditable="true" oninput="updateCV()"></td></tr>';
  // clear photo
  document.getElementById('profileSmall').querySelector('img').src = '';
  document.getElementById('photoPreview').src = '';
  updateCV();
}

/* ---------- PDF generation (A4, includes images) ---------- */
function downloadPDF(){
  // ensure latest preview values
  updateCV();

  const element = document.getElementById('cvPage');

  // make sure images are rendered as normal elements (not absolute) - they already are
  element.querySelectorAll('img').forEach(img=>{
    img.style.maxWidth = '100%';
    img.style.height = 'auto';
  });

  // configure html2pdf with A4 settings
  html2pdf().set({
    margin: 0.25, // inches
    filename: 'My_CV.pdf',
    jsPDF: { unit:'in', format:'a4', orientation:'portrait' },
    html2canvas: { scale: 2, useCORS: true, allowTaint: true }
  }).from(element).save();
}
</script>
</body>
</html>
  <!-- ðŸ”’ Protection Script -->
  <script>
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.onkeydown = function(e) {
      if (e.keyCode == 123) return false;
      if (e.ctrlKey && e.shiftKey && ['I','C','J'].includes(String.fromCharCode(e.keyCode))) return false;
      if (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) return false;
    };
    document.addEventListener('copy', e => e.preventDefault());
    document.addEventListener('selectstart', e => e.preventDefault());
  </script>
</body>
</html>
